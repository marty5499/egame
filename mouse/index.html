<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Web:Bit</title>
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-62202920-13"></script>
    <script src="https://webbit.webduino.io/blockly/dist/google-gtag.min.js"></script>
    <link rel="stylesheet" href="https://webbit.webduino.io/blockly/components/jquery-ui/themes/base/jquery-ui.min.css">
    <script src="https://webbit.webduino.io/blockly/components/jquery/dist/jquery.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/lib/webduino-all.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/webduino-js-plugin/BitIRled.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/webduino-js-plugin/BitIRRecv.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/edu.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/edu-mpu9250.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/edu-blockly.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/MessageTransport.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/webduino-blockly.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/lib/firebase.min.js"></script>
    <script src="https://webbit.webduino.io/blockly/dist/lib/runtime.min.js"></script>
    <link rel="stylesheet" href="https://webbit.webduino.io/blockly/dist/css/main.css">
    <script src="https://marty5499.github.io/webduino-module-pixi/adapter.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/webRTC.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/camera.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/opencv.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/imageFilter.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/actor.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/HotSpot.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/pixi5.min.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/pixi-library.js"></script>
    <script src="https://marty5499.github.io/webduino-module-pixi/pixi-blockly.js"></script>
    <script src="https://marty5499.github.io/webduino-module-handsDetect/camera.js"></script>
    <script src="https://marty5499.github.io/webduino-module-handsDetect/tfjs@latest.min.js"></script>
    <script src="https://marty5499.github.io/webduino-module-handsDetect/handtrack.min.js"></script>
    <script src="https://marty5499.github.io/webduino-module-handsDetect/HandsDetect.js"></script>
    <script src="https://marty5499.github.io/webduino-module-handsDetect/hands-blockly.js"></script>
</head>

<body>
    <div id="bg"></div>
    <div id="userHtml"></div>
    <span id="reset">↻</span>
    <div id="youtube-container">
        <div id="player"></div>
    </div>
    <div id="recordingArea">
        <svg version="1.1" id="mic_icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 21 23" width="26px" height="36px" xml:space="preserve">
            <path id="mic" d="M5,10.8V4.6C5,2.1,7,0,9.5,0c2.5,0,4.6,2.1,4.6,4.6v6.3c0,2.5-2.1,4.6-4.6,4.6C7,15.4,5,13.3,5,10.8z M17.3,10.4
   c0-0.4-0.3-0.8-0.8-0.8s-0.8,0.3-0.8,0.8c0,3.4-2.8,6.2-6.2,6.2s-6.2-2.8-6.2-6.2C3.3,10,3,9.7,2.5,9.7S1.8,10,1.8,10.4
   c0,4,3.1,7.3,7,7.7v1.7H5.4c-0.4,0-0.8,0.3-0.8,0.8s0.3,0.8,0.8,0.8h8.2c0.4,0,0.8-0.3,0.8-0.8s-0.3-0.8-0.8-0.8h-3.4v-1.7
   C14.2,17.7,17.3,14.4,17.3,10.4z"></path>
            <g id="mic_stop">
                <path class="st1" d="M2,20.3c-0.2,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.3L17.7,2.3c0.4-0.4,1-0.4,1.3,0c0.4,0.4,0.4,1,0,1.3L2.6,20
     C2.4,20.2,2.2,20.3,2,20.3z"></path>
                <path class="st2" d="M18.3,2c0.2,0,0.5,0.1,0.7,0.3c0.4,0.4,0.4,1,0,1.3L2.6,20c-0.2,0.2-0.4,0.3-0.7,0.3c-0.2,0-0.5-0.1-0.7-0.3
     c-0.4-0.4-0.4-1,0-1.3L17.7,2.3C17.8,2.1,18.1,2,18.3,2 M18.3,1c-0.5,0-1,0.2-1.4,0.6L0.6,17.9C0.2,18.3,0,18.8,0,19.3
     s0.2,1,0.6,1.4c0.4,0.4,0.9,0.6,1.4,0.6c0.5,0,1-0.2,1.4-0.6L19.7,4.3C20.1,4,20.3,3.5,20.3,3s-0.2-1-0.6-1.4
     C19.3,1.2,18.8,1,18.3,1L18.3,1z"></path>
            </g>
        </svg>
    </div>
    <div id="tracker-container" hidden="">
        <div id="tracker-wrap">
            <video id="trackingVideo" width="320" height="240" preload="" autoplay="" loop="" muted="" controls=""></video>
            <canvas id="trackingCanvas" width="320" height="240"></canvas>
            <canvas id="trackingCanvasColor" width="320" height="240"></canvas>
        </div>
    </div>
    <div id="videoDetect-container">
        <div id="videoDetect-wrap">
            <canvas id="videoDetectCanvas" width="320" height="240"></canvas>
        </div>
    </div>
    <div id="inputArea">
        <input id="input" autocomplete="off" autofocus=""><span id="send">✔</span>
    </div>
    <div id="demoMonster01" class="monster">
        <span class="talk"></span>
        <div class="m-img" attr-emotion="0"></div>
    </div>
    <div id="demoMonster02" class="monster">
        <span class="talk"></span>
        <div class="m-img" attr-emotion="0"></div>
    </div>
    <div id="demoMonster03" class="monster">
        <span class="talk"></span>
        <div class="m-img" attr-emotion="0"></div>
    </div>
    <div id="demoMonster04" class="monster">
        <span class="talk"></span>
        <div class="m-img" attr-emotion="0"></div>
    </div>

    <div id="sound01" style="display:none;">
        <audio data-src="media/sound/cat-01.mp3" class="sound cat-01"></audio>
        <audio data-src="media/sound/dog-01.mp3" class="sound dog-01"></audio>
        <audio data-src="media/sound/crow-01.mp3" class="sound crow-01"></audio>
        <audio data-src="media/sound/elephant-01.mp3" class="sound elephant-01"></audio>
        <audio data-src="media/sound/frog-01.mp3" class="sound frog-01"></audio>
        <audio data-src="media/sound/lion-01.mp3" class="sound lion-01"></audio>
        <audio data-src="media/sound/goat-01.mp3" class="sound goat-01"></audio>
        <audio data-src="media/sound/chicken-01.mp3" class="sound chicken-01"></audio>
        <audio data-src="media/sound/chicken-02.mp3" class="sound chicken-02"></audio>
        <audio data-src="media/sound/monkey-01.mp3" class="sound monkey-01"></audio>
        <audio data-src="media/sound/duck-01.mp3" class="sound duck-01"></audio>
        <audio data-src="media/sound/mouse-01.mp3" class="sound mouse-01"></audio>
        <audio data-src="media/sound/pig-01.mp3" class="sound pig-01"></audio>
    </div>
    <div id="sound02" style="display:none;">
        <audio data-src="media/sound/sneeze-01.mp3" class="sound sneeze-01"></audio>
        <audio data-src="media/sound/laugth-01.mp3" class="sound laugth-01"></audio>
        <audio data-src="media/sound/cough-01.mp3" class="sound cough-01"></audio>
        <audio data-src="media/sound/kiss-01.mp3" class="sound kiss-01"></audio>
        <audio data-src="media/sound/applaud-01.mp3" class="sound applaud-01"></audio>
        <audio data-src="media/sound/cry-01.mp3" class="sound cry-01"></audio>
        <audio data-src="media/sound/snoring-01.mp3" class="sound snoring-01"></audio>
        <audio data-src="media/sound/fart-01.mp3" class="sound fart-01"></audio>
        <audio data-src="media/sound/whistle-01.mp3" class="sound whistle-01"></audio>
        <audio data-src="media/sound/snore-01.mp3" class="sound snore-01"></audio>
        <audio data-src="media/sound/sigh-01.mp3" class="sound sigh-01"></audio>
        <audio data-src="media/sound/sigh-02.mp3" class="sound sigh-02"></audio>
    </div>

    <div id="sound03" style="display:none;">
        <audio data-src="media/sound/sound-01.mp3" class="sound sound-01"></audio>
        <audio data-src="media/sound/sound-02.mp3" class="sound sound-02"></audio>
        <audio data-src="media/sound/sound-03.mp3" class="sound sound-03"></audio>
        <audio data-src="media/sound/sound-04.mp3" class="sound sound-04"></audio>
        <audio data-src="media/sound/sound-05.mp3" class="sound sound-05"></audio>
        <audio data-src="media/sound/sound-06.mp3" class="sound sound-06"></audio>
        <audio data-src="media/sound/sound-07.mp3" class="sound sound-07"></audio>
        <audio data-src="media/sound/sound-08.mp3" class="sound sound-08"></audio>
        <audio data-src="media/sound/sound-09.mp3" class="sound sound-09"></audio>
        <audio data-src="media/sound/sound-10.mp3" class="sound sound-10"></audio>
        <audio data-src="media/sound/sound-11.mp3" class="sound sound-11"></audio>
        <audio data-src="media/sound/coin-01.mp3" class="sound coin-01"></audio>
        <audio data-src="media/sound/jump-01.mp3" class="sound jump-01"></audio>
        <audio data-src="media/sound/death-01.mp3" class="sound death-01"></audio>
        <audio data-src="media/sound/bell-01.mp3" class="sound bell-01"></audio>
    </div>

    <script src="https://webbit.webduino.io/blockly/dist/template/main.min.js"></script>

    <script>
        'use strict';

        function _asyncToGenerator(fn) {
            return function() {
                var gen = fn.apply(this, arguments);
                return new Promise(function(resolve, reject) {
                    function step(key, arg) {
                        try {
                            var info = gen[key](arg);
                            var value = info.value;
                        } catch (error) {
                            reject(error);
                            return;
                        }
                        if (info.done) {
                            resolve(value);
                        } else {
                            Promise.resolve(value).then(function(value) {
                                step("next", value);
                            }, function(err) {
                                step("throw", err);
                            });
                        }
                    }
                    step("next");
                });
            };
        }

        _asyncToGenerator(regeneratorRuntime.mark(function _callee2() {
            var hands, camera, x, y, stage, lastX, pipe, lastY, start, box, gogogo, pass, finish, _E5_BB_BA_E7_AB_8B_E9_81_8A_E6_88_B2_E8_88_9E_E5_8F_B0_E8_88_87_E8_A7_92_E8_89_B2;

            return regeneratorRuntime.wrap(function _callee2$(_context2) {
                while (1) {
                    switch (_context2.prev = _context2.next) {
                        case 0:
                            _E5_BB_BA_E7_AB_8B_E9_81_8A_E6_88_B2_E8_88_9E_E5_8F_B0_E8_88_87_E8_A7_92_E8_89_B2 = (function() {
                                var ref = _asyncToGenerator(regeneratorRuntime.mark(function _callee() {
                                    return regeneratorRuntime.wrap(function _callee$(_context) {
                                        while (1) {
                                            switch (_context.prev = _context.next) {
                                                case 0:
                                                    _context.next = 2;
                                                    return createCamera("0", 640, 480, 0, true, 0.1);

                                                case 2:
                                                    camera = _context.sent;

                                                    hands = new HandDetect();
                                                    hands.setCamera(camera);
                                                    stage = new PIXI_Game(camera.getCanvas());
                                                    pipe = new PIXI_Pipe(stage);
                                                    pipe.setColor(0xc0c0c0);
                                                    pipe.draw(JSON.parse('[7,209,60,67,208,60,127,204,60,182,215,55,200,262,50,217,311,50,250,349,50,300,345,50,339,312,50,361,267,45,379,224,45,400,175,50,435,130,55,483,100,55,545,87,60,612,79,65,47,538,65,40,603,65]'));
                                                    _context.next = 11;
                                                    return new PIXI_Actor(stage, 'http://webduino.tw/start.png');

                                                case 11:
                                                    start = _context.sent;

                                                    start.size(100, 100);
                                                    start.pos(0, 130);
                                                    _context.next = 16;
                                                    return new PIXI_Actor(stage, 'http://webduino.tw/finish.png');

                                                case 16:
                                                    finish = _context.sent;

                                                    finish.size(100, 100);
                                                    finish.pos(999, 350);
                                                    _context.next = 21;
                                                    return new PIXI_Actor(stage, 'http://webduino.tw/mouse.png');

                                                case 21:
                                                    box = _context.sent;

                                                    box.size(60, 40);
                                                    box.pos(999, 999);

                                                case 24:
                                                case 'end':
                                                    return _context.stop();
                                            }
                                        }
                                    }, _callee, this);
                                }));

                                return function _E5_BB_BA_E7_AB_8B_E9_81_8A_E6_88_B2_E8_88_9E_E5_8F_B0_E8_88_87_E8_A7_92_E8_89_B2() {
                                    return ref.apply(this, arguments);
                                };
                            })();

                            $bg.fullScreen();
                            $demoMonster01.display('hide');
                            $demoMonster02.display('hide');
                            $demoMonster03.display('hide');
                            $demoMonster04.display('hide');
                            $demoMonster01.display('show');
                            $demoMonster02.display('show');
                            $demoMonster02.emotion('2');
                            lastX = 0;
                            lastY = 0;
                            gogogo = false;
                            pass = true;
                            _context2.next = 15;
                            return _E5_BB_BA_E7_AB_8B_E9_81_8A_E6_88_B2_E8_88_9E_E5_8F_B0_E8_88_87_E8_A7_92_E8_89_B2();

                        case 15:
                            start.collision(function(self, other) {
                                $demoMonster01.talk('開始~~');
                                $demoMonster02.talk('加油加油...');
                                gogogo = true;
                                start.destroy();
                                finish.pos(520, 50);
                            });
                            finish.collision(function(self, other) {
                                finish.destroy();
                                $demoMonster01.display('hide');
                                if (pass) {
                                    $demoMonster02.talk('過關啦～');
                                    $demoMonster02.emotion('1');
                                } else {
                                    $demoMonster02.emotion('3');
                                    $demoMonster02.talk('請繼續加油...');
                                }
                            });

                            hands.on(function(handInfo) {
                                x = (640 - hands.handInfo[0] - 300) * (1 / (500 - 300)) * (640 - 0) + 0;
                                y = (hands.handInfo[1] - 50) * (1 / (250 - 50)) * (480 - 0) + 0;
                                x = (lastX + x) / 1;
                                y = (lastY + y) / 1;
                                box.pos(x, y);
                                if (gogogo && pipe.outOfBound(x, y, 0.8)) {
                                    $demoMonster01.emotion('4');
                                    $demoMonster01.talk('碰到了');
                                    pass = false;
                                }
                            });
                            _context2.next = 20;
                            return hands.start("#ff0000", 5);

                        case 20:
                            hands.startCam("#ff0000", 5);

                        case 21:
                        case 'end':
                            return _context2.stop();
                    }
                }
            }, _callee2, this);
        }))();
    </script>
</body>

</html>